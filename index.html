<!DOCTYPE html>

<html>

<head>
    <meta charset="UTF-8">
    <title>Canvas</title>

    <style type="text/css">
        canvas {
            border: 2px solid;
        }
    </style>

</head>

<body>

    <canvas id="Breakout"></canvas>

    <button onclick="playGame()">Play</button>

    <script type="text/javascript">
        // Gets a handle to the element with id canvasOne.
        var canvas = document.getElementById("Breakout");
        // Get a 2D context for the canvas.
        var ctx = canvas.getContext("2d");

        canvas.height = 600;
        canvas.width = 700;

        var rects = [];
        var keyState = {};
        const BRICK_COUNT = 36;


        //Creating ball object
        var ball = {
            position: {
                x: canvas.width / 2,
                y: canvas.height / 2
            },
            ballCollisionLocation: 4,
            ballSpeed: 3,
            volocity: {
                x: 1,
                y: 1
            },
            acceleration: {
                x: 0.1,
                y: 0.2
            },
            radius: 10,
            padddleCollision: false,

            draw: function () {
                ctx.beginPath();
                ctx.arc(this.position.x, this.position.y, this.radius, 0, 2 * Math.PI, false);
                ctx.fillStyle = "rgb(0,0,255)";
                ctx.fill();
                ctx.closePath();
            },
            move: function () {
                this.position.x += this.volocity.x;
                this.position.y += this.volocity.y;
                this.volocity.x += this.acceleration.x;
                this.volocity.y += this.acceleration.y;
            }
        }

        //Creating paddle object
        var paddle = {
            height: 10,
            width: 100,
            speed: 10, //Affects where the paddls boundries are *** FIX **

            position: {
                x: canvas.width / 2 - 50,
                y: canvas.height - 20
            },
            createPaddle: function () {
                ctx.beginPath();
                ctx.fillStyle = "rgb(0,0,100)";;
                ctx.fillRect(this.position.x, this.position.y, this.width, this.height);
                ctx.stroke();
                ctx.closePath();
            }
        }

        //creating brick object
        var Brick = {
            height: 20,
            width: 50,
            hit: false,
            position: { //position of first block
                x: 20,
                y: 40
            },

            Setup: function (x, y, hit, w, h) {
                this.x = x;
                this.y = y;
                this.w = w;
                this.h = h;
                this.hit = hit;

                this.draw = function () {
                    ctx.beginPath();
                    ctx.fillStyle = "rgb(100,0,0)";
                    ctx.fillRect(x, y, w, h);
                    ctx.stroke();
                    ctx.closePath();
                }
            }
        }

        paddle.createPaddle(); //Draw the paddle
        ball.draw(); //Draw the ball
        CreateBricks(); //Creates all the brick before the game starts
        //Draws all the brick OBJS out to the screen
        for (var i in rects) {
            rects[i].draw();
        }

        //Creates all the brick objects each with there own properities in a rects[] array
        function CreateBricks() {
            for (var i = 0; i < BRICK_COUNT; i++) {
                //setup all bricks to have x, y and hit valuse to false(not HIT)
                rects[i] = new Brick.Setup(Brick.position.x, Brick.position.y, Brick.hit, Brick.width, Brick.height);
                Brick.position.x += 55;

                if (Brick.position.x + Brick.width >= canvas.width) {
                    Brick.position.y += 30;
                    Brick.position.x = 20;
                }
            }
        }

        function playGame() {
            requestAnimationFrame(animate);
        }

        //ANIMATE THE GAME
        function animate(highResTimestamp) {
            // CLEARS THE BALL
            ctx.clearRect(ball.position.x - ball.radius - 1, ball.position.y - ball.radius - 1, ball.radius * 2 + 2, ball.radius * 2 + 2);


            //Draw the remaining bricks in the array that arnt hit
            for (var i in rects) {
                if (rects[i].h == false)
                    rects[i].draw();
                else
                    i++;
            }

            moveBall(); //move the balls x/y pos
            ball.draw(); //creat the ball at new x/y pos
            paddle.createPaddle(); //create paddle so it dosnt disappear on collision

            ballPaddleCollision();

            ballWallCollision();



            requestAnimationFrame(animate); //repeat the animation
        }

        //Moves the ball based on the collision number
        function moveBall() {
            //switch on the ballCollisionLocation (int) to see if ball goes left/right/mid
            switch (ball.ballCollisionLocation) {
                //paddle collision 1 - 3
            case 1: //ball hit the left of the paddle
                ball.position.x -= ball.ballSpeed;
                ball.position.y -= ball.ballSpeed;
                break;
            case 2: //send ball up
                ball.position.y -= ball.ballSpeed
                break;
            case 3: //ball hit the right of the paddle

                ball.position.x += ball.ballSpeed;
                ball.position.y -= ball.ballSpeed;
                break;

                //wall collision with ball
            case 4: //send ball down
                ball.position.y += ball.ballSpeed;
                break;

            case 5: //send ball left and up
                ball.position.x -= ball.ballSpeed;
                ball.position.y -= ball.ballSpeed;
                break;
            case 6: //send ball right and up
                ball.position.x += ball.ballSpeed;
                ball.position.y -= ball.ballSpeed;
                break;

            case 7: //send ball left and down
                ball.position.x -= ball.ballSpeed;
                ball.position.y += ball.ballSpeed;
                break;
            case 8: //send ball right and down
                ball.position.x += ball.ballSpeed;
                ball.position.y += ball.ballSpeed;
                break;
            case 9: //send ball right and down
                ball.position.x += ball.ballSpeed;
                ball.position.y += ball.ballSpeed;
                break;
            }
            console.log(ball.ballCollisionLocation);
        }

        //BALL HIT OFF PADDLE DIRECTION CONTROL
        function ballPaddleCollision() {
            //if the ball hits the paddle anywhere
            if (ball.position.y + ball.radius >= paddle.position.y && ball.position.x >= paddle.position.x && ball.position.x <= paddle.position.x + paddle.width) {
                console.log("Ball hit the Paddle");

                //if the ball hits the Left of the paddle
                if ((ball.position.x <= paddle.position.x + paddle.width / 3)) {
                    ball.ballCollisionLocation = 1;
                }

                //if the ball hits the Center of the paddle
                else if ((ball.position.x <= paddle.position.x + paddle.width - 30)) {
                    ball.ballCollisionLocation = 2;
                }

                //if the ball hits the Right of the paddle
                else if ((ball.position.x <= paddle.position.x + paddle.width)) {

                    ball.ballCollisionLocation = 3;
                }

            }
            if ((ball.ballCollisionLocation != 1 || ball.ballCollisionLocation != 2 || ball.ballCollisionLocation != 3) && ball.position.y >= canvas.height) {
                console.log("You lost a life");
                livesLeft--;
                resetGame();
            }
        }

        //collision control for the ball hitting the wall
        function ballWallCollision() {

            //Did the ball hit the wall
            if (ball.position.y - ball.radius <= canvas.clientTop || ball.position.x + ball.radius >= canvas.width || ball.position.x - ball.radius <= canvas.clientLeft) {
                console.log("Ball Hit A Wall");

                //if the ball hit the left wall
                if (ball.position.x - ball.radius <= canvas.clientLeft) {
                    console.log("Ball Hit left Wall");
                    if (ball.ballCollisionLocation == 5 || ball.ballCollisionLocation == 1) {
                        ball.ballCollisionLocation = 6; //ball right and up
                    } else if (ball.ballCollisionLocation == 7) {
                        ball.ballCollisionLocation = 8; //ball down and right   
                    }
                }

                //if the ball hit the right wall
                if (ball.position.x + ball.radius >= canvas.width) {
                    console.log("Ball Hit right Wall");
                    if (ball.ballCollisionLocation == 3 || ball.ballCollisionLocation == 6) {
                        ball.ballCollisionLocation = 5;
                    } else if (ball.ballCollisionLocation == 8 || ball.ballCollisionLocation == 9) {
                        ball.ballCollisionLocation = 7;
                    }
                }

                //if the ball hit the Roof wall
                if (ball.position.y - ball.radius <= canvas.clientTop) {

                    //Find where the ball hit the roof from 
                    if (ball.ballCollisionLocation == 2) {
                        ball.ballCollisionLocation = 4; //ball come down
                    }
                    //
                    else if ((ball.ballCollisionLocation == 5) || (ball.ballCollisionLocation == 1)) {
                        ball.ballCollisionLocation = 7;

                    }
                    //
                    else if ((ball.ballCollisionLocation == 6) || (ball.ballCollisionLocation == 3)) {
                        ball.ballCollisionLocation = 9;

                    }
                }
            }
        }



        // event listeners for key-up and key-down events
        window.addEventListener('keydown', function (e) {
            keyState[e.keyCode || e.which] = true;
        }, true);
        window.addEventListener('keyup', function (e) {
            keyState[e.keyCode || e.which] = false;
        }, true);

        //used for creating smooth panning left and right for the paddle
        function paddleLoop(highResTimestamp) {
            ctx.clearRect(paddle.position.x, paddle.position.y, paddle.width, paddle.height);

            if ((keyState[37] || keyState[65]) && paddle.position.x >= canvas.clientLeft) {
                paddle.position.x -= paddle.speed;
            }
            if ((keyState[39] || keyState[68]) && paddle.position.x != canvas.width - paddle.width) {
                paddle.position.x += paddle.speed;
            }
            paddle.createPaddle();

            requestAnimationFrame(paddleLoop);
        }
        paddleLoop();
    </script>

</body>

</html>